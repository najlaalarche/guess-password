<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Guess The Password ‚Äì Speed Challenge</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#0b1220;color:#e8eefc}
  .wrap{max-width:900px;margin:auto;padding:18px}
  .card{background:#121c33;border:1px solid #223154;border-radius:16px;padding:16px;margin:12px 0}
  .h1{font-size:22px;font-weight:900}
  .h2{font-size:16px;font-weight:800}
  .muted{opacity:.8}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  input{flex:1;padding:12px;border-radius:12px;border:1px solid #2a3b66;background:#0b1220;color:#e8eefc;font-size:16px}
  button{padding:12px 14px;border-radius:12px;border:0;background:#2b6cff;color:white;font-weight:800;font-size:16px;cursor:pointer}
  button:disabled{opacity:.55;cursor:not-allowed}
  .badge{padding:6px 10px;border-radius:999px;border:1px solid #2a3b66;background:#0b1220;font-size:13px;display:inline-block}
  .bad{background:#2a1111;border-color:#b13a3a}
  .ok{background:#0c2a16;border-color:#1f7a43}
  .warn{background:#2a250f;border-color:#caa43a}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  .progress{height:10px;border-radius:999px;background:#0b1220;border:1px solid #2a3b66;overflow:hidden;margin-top:10px}
  .bar{height:100%;width:0%;background:#2b6cff}
  .bigwin{font-size:30px;font-weight:900}
  pre{white-space:pre-wrap;line-height:1.35;margin:0}
  .small{font-size:12px;opacity:.75}
</style>
</head>

<body>
<div class="wrap">

  <div class="card">
    <div class="h1">üîê Guess The Password ‚Äì Speed Challenge</div>
    <div class="muted">Essais illimit√©s ‚Ä¢ Indice apr√®s 40s ‚Ä¢ Passage auto apr√®s 60s ‚Ä¢ Validation au stand</div>
    <div class="row" style="margin-top:10px">
      <span class="badge" id="qBadge">Question 1/20</span>
      <span class="badge" id="timerBadge">‚è≥ 01:00</span>
      <span class="badge mono">FORMAT: mot_minuscule_nombre!</span>
    </div>
  </div>

  <div class="card" id="gameCard">
    <div class="h2">üìÑ Dossier / Devinette</div>
    <pre id="prompt"></pre>

    <div class="progress"><div class="bar" id="bar"></div></div>

    <div class="row" style="margin-top:10px">
      <input id="pw" placeholder="mot_minuscule_nombre!" autocomplete="off"/>
      <button id="btn">TESTER</button>
      <button id="skipBtn" style="background:#44506b">PASSER</button>
    </div>

    <div id="msg" class="badge muted" style="margin-top:10px">Essais illimit√©s. Teste des combinaisons probables.</div>
    <div id="hintBox" class="badge warn" style="display:none;margin-top:10px">
      üí° Indice : <span id="hintText"></span>
    </div>

    <div class="small" style="margin-top:10px">
      Le ‚Äúmot‚Äù est sans espaces, sans accents, en minuscule.
    </div>
  </div>

  <div class="card" id="winCard" style="display:none">
    <div class="bigwin">‚úÖ ACCESS GRANTED</div>
    <div class="muted" style="margin-top:6px">Montre ce code au stand :</div>
    <div class="badge ok mono" id="winCode" style="margin-top:10px"></div>
    <div class="small" style="margin-top:10px">Le jeu est bloqu√© apr√®s victoire (normal).</div>
  </div>

  <div class="card" id="adminCard" style="display:none">
    <div class="h2">üõ†Ô∏è Organisateur</div>
    <div class="row">
      <button id="resetBtn" style="background:#b13a3a">RESET (effacer victoire)</button>
    </div>
    <div class="small" style="margin-top:8px">Visible uniquement avec <span class="mono">?admin=1</span></div>
  </div>

</div>

<script>
  // ========= R√©glages temps demand√©s =========
  const HINT_AFTER_MS = 40_000; // 40s
  const AUTO_SKIP_MS  = 60_000; // 60s (1 min)

  // ========= Questions: bios + devinettes (plus r√©alistes) =========
  // Mot de passe: mot_minuscule_nombre!
  const QUESTIONS = [
    {
      prompt: `Q1 ‚Äî Bio (Simo)
Simo est n√© en 2001.
Sur ses r√©seaux, il r√©p√®te souvent ‚Äúfamily first‚Äù.
Il met g√©n√©ralement un mot tr√®s court + une ann√©e.

Devine son mot de passe le plus probable.`,
      hint: `Le mot est li√© √† "family first"`,
      answer: `family_2001!`
    },
    {
      prompt: `Q2 ‚Äî Bio (Aya)
Aya adore la photo, mais elle ne dit jamais ‚Äúphotographie‚Äù.
Elle dit toujours ‚Äúlens‚Äù.
Elle choisit son nombre pr√©f√©r√© : 13.

Mot de passe probable ?`,
      hint: `mot = lens`,
      answer: `lens_13!`
    },
    {
      prompt: `Q3 ‚Äî Devinette
Je suis ce que tout le monde veut,
mais que personne ne peut garder pour toujours.

Mot = r√©ponse, nombre = lettres.`,
      hint: `mot courant`,
      answer: `temps_5!`
    },
    {
      prompt: `Q4 ‚Äî Bio (Youssef)
Youssef est fan de foot.
Il n‚Äô√©crit jamais le nom du joueur complet.
Il garde seulement le surnom ‚Äúgoat‚Äù.
Nombre = 10.

Mot de passe ?`,
      hint: `mot = goat`,
      answer: `goat_10!`
    },
    {
      prompt: `Q5 ‚Äî Devinette
Plus je s√®che, plus je deviens mouill√©e.

Mot = r√©ponse, nombre = lettres.`,
      hint: `objet maison`,
      answer: `serviette_9!`
    },
    {
      prompt: `Q6 ‚Äî Bio (Sara)
Sara met rarement son pr√©nom.
Elle met son ‚Äúmood‚Äù pr√©f√©r√©: ‚Äúcalm‚Äù.
Nombre = √¢ge : 22.

Mot de passe probable ?`,
      hint: `mot = calm`,
      answer: `calm_22!`
    },
    {
      prompt: `Q7 ‚Äî Bio (Hicham)
Hicham a un chien nomm√© ‚Äúrocky‚Äù.
Il met toujours le nom du chien.
Nombre = 2 (2 ans).

Mot de passe ?`,
      hint: `mot = rocky`,
      answer: `rocky_2!`
    },
    {
      prompt: `Q8 ‚Äî Devinette
Je peux te sauver, ou te trahir.
Je suis fait de lettres et de chiffres.

Mot = r√©ponse, nombre = lettres.`,
      hint: `th√®me du jeu`,
      answer: `password_8!`
    },
    {
      prompt: `Q9 ‚Äî Bio (Hamza gamer)
Hamza est ‚ÄúDarkWolf‚Äù.
Mais il pr√©f√®re le mot ‚Äúshadow‚Äù.
Nombre = 4 (son chiffre porte-bonheur).

Mot de passe ?`,
      hint: `mot = shadow`,
      answer: `shadow_4!`
    },
    {
      prompt: `Q10 ‚Äî Devinette
Je suis quelque chose que tu as
quand tu n‚Äôas plus rien √† dire.

Mot = r√©ponse, nombre = lettres.`,
      hint: `absence de bruit`,
      answer: `silence_7!`
    },
    {
      prompt: `Q11 ‚Äî Bio (Imane)
Imane adore le bleu‚Ä¶ mais elle √©crit ‚Äúocean‚Äù.
Nombre = 4.

Mot de passe probable ?`,
      hint: `mot = ocean`,
      answer: `ocean_4!`
    },
    {
      prompt: `Q12 ‚Äî Bio (Lina)
Lina a un chat ‚Äúluna‚Äù, mais elle utilise le surnom ‚Äúmoon‚Äù.
Nombre = 3 (√¢ge).

Mot de passe ?`,
      hint: `mot = moon`,
      answer: `moon_3!`
    },
    {
      prompt: `Q13 ‚Äî Devinette
Je grandis quand on me partage.

Mot = r√©ponse, nombre = lettres.`,
      hint: `pas un objet`,
      answer: `joie_4!`
    },
    {
      prompt: `Q14 ‚Äî Bio (Salma)
Salma veut voyager au Japon, mais elle √©crit ‚Äútokyo‚Äù.
Nombre = 5 (lettres du mot).

Mot de passe ?`,
      hint: `mot = tokyo`,
      answer: `tokyo_5!`
    },
    {
      prompt: `Q15 ‚Äî Devinette
Je suis invisible, mais je peux te suivre partout.

Mot = r√©ponse, nombre = lettres.`,
      hint: `en ligne`,
      answer: `trace_5!`
    },
    {
      prompt: `Q16 ‚Äî Bio (Omar)
Omar met souvent ‚Äúroot‚Äù.
Nombre = 1.

Mot de passe probable ?`,
      hint: `mot = root`,
      answer: `root_1!`
    },
    {
      prompt: `Q17 ‚Äî Devinette (tech)
Je suis √† 2 facteurs.
Sans moi, tu ne te connectes pas.

Mot = r√©ponse, nombre = 6.`,
      hint: `souvent 6 chiffres`,
      answer: `code_6!`
    },
    {
      prompt: `Q18 ‚Äî Bio (Nadia)
Nadia adore les tacos mais elle √©crit ‚Äútaco‚Äù (sans s).
Nombre = 2.

Mot de passe ?`,
      hint: `mot = taco`,
      answer: `taco_2!`
    },
    {
      prompt: `Q19 ‚Äî Devinette
Je suis la chose la plus cass√©e sur un t√©l√©phone.

Mot = r√©ponse, nombre = lettres.`,
      hint: `on la remplace souvent`,
      answer: `ecran_5!`
    },
    {
      prompt: `Q20 ‚Äî Finale
Phrase: ‚ÄúNever give up‚Äù
Mot = dernier mot, nombre = lettres.`,
      hint: `mot = up`,
      answer: `up_2!`
    }
  ];

  // ========= UI =========
  const qBadge = document.getElementById("qBadge");
  const timerBadge = document.getElementById("timerBadge");
  const promptEl = document.getElementById("prompt");
  const pwEl = document.getElementById("pw");
  const btnEl = document.getElementById("btn");
  const skipBtnEl = document.getElementById("skipBtn");
  const msgEl = document.getElementById("msg");
  const hintBox = document.getElementById("hintBox");
  const hintText = document.getElementById("hintText");
  const barEl = document.getElementById("bar");
  const winCard = document.getElementById("winCard");
  const gameCard = document.getElementById("gameCard");
  const winCodeEl = document.getElementById("winCode");

  // Admin
  const qs = new URLSearchParams(location.search);
  if (qs.get("admin") === "1") {
    document.getElementById("adminCard").style.display = "block";
    document.getElementById("resetBtn").onclick = () => {
      localStorage.removeItem("WIN_CODE");
      location.reload();
    };
  }

  function pad(n){ return String(n).padStart(2,"0"); }
  function setBad(t){ msgEl.className="badge bad"; msgEl.textContent=t; }
  function setInfo(t){ msgEl.className="badge muted"; msgEl.textContent=t; }
  function formatMMSS(ms){
    const s = Math.max(0, Math.ceil(ms/1000));
    const mm = Math.floor(s/60);
    const ss = s%60;
    return `${pad(mm)}:${pad(ss)}`;
  }
  function makeWinCode(qIndex){
    const now = new Date();
    const t = `${pad(now.getHours())}${pad(now.getMinutes())}${pad(now.getSeconds())}`;
    const rand = Math.random().toString(36).slice(2,6).toUpperCase();
    return `Q${qIndex+1}-${t}-${rand}`;
  }

  // ========= Game state =========
  let qIndex = 0;
  let qStart = 0;
  let hintShown = false;
  let hintTimeout = null;
  let skipTimeout = null;
  let uiInterval = null;
  let gameOver = false;

  const WIN_KEY = "WIN_CODE";
  const existing = localStorage.getItem(WIN_KEY);
  if (existing) {
    // Already won on this device ‚Üí show WIN only, and STOP everything
    gameOver = true;
    gameCard.style.display = "none";
    winCard.style.display = "block";
    winCodeEl.textContent = existing;
  }

  function clearTimers(){
    if (hintTimeout) { clearTimeout(hintTimeout); hintTimeout = null; }
    if (skipTimeout) { clearTimeout(skipTimeout); skipTimeout = null; }
    if (uiInterval)  { clearInterval(uiInterval); uiInterval = null; }
  }

  function showHintOnce(){
    if (hintShown || gameOver) return;
    hintShown = true;
    hintText.textContent = QUESTIONS[qIndex].hint;
    hintBox.style.display = "inline-block";
  }

  function scheduleTimers(){
    clearTimers(); // important: clear old timers when switching questions
    // timers actions
    hintTimeout = setTimeout(() => { if (!gameOver) showHintOnce(); }, HINT_AFTER_MS);
    skipTimeout = setTimeout(() => { if (!gameOver) nextQuestion(); }, AUTO_SKIP_MS);

    // UI refresh
    uiInterval = setInterval(() => {
      if (gameOver) return;
      const elapsed = Date.now() - qStart;
      const remaining = Math.max(0, AUTO_SKIP_MS - elapsed);
      timerBadge.textContent = `‚è≥ ${formatMMSS(remaining)}`;
      barEl.style.width = Math.min(100, (elapsed / AUTO_SKIP_MS) * 100) + "%";

      // visual catch-up
      if (!hintShown && elapsed >= HINT_AFTER_MS) showHintOnce();
      if (elapsed >= AUTO_SKIP_MS) nextQuestion(); // fallback safety
    }, 200);
  }

  function loadQuestion(i){
    if (gameOver) return;
    qIndex = i;
    qStart = Date.now();
    hintShown = false;

    qBadge.textContent = `Question ${qIndex+1}/20`;
    promptEl.textContent = QUESTIONS[qIndex].prompt;
    hintBox.style.display = "none";
    setInfo("Essais illimit√©s. Indice √† 40s.");
    pwEl.value = "";
    pwEl.focus();

    scheduleTimers();
  }

  function nextQuestion(){
    if (gameOver) return;
    if (qIndex >= QUESTIONS.length - 1) {
      clearTimers();
      setInfo("Fin des 20 questions.");
      btnEl.disabled = true;
      skipBtnEl.disabled = true;
      return;
    }
    loadQuestion(qIndex + 1);
  }

  function winNow(){
    gameOver = true;
    clearTimers();
    const code = makeWinCode(qIndex);
    localStorage.setItem(WIN_KEY, code);
    gameCard.style.display = "none";
    winCard.style.display = "block";
    winCodeEl.textContent = code;
  }

  function checkPassword(){
    if (gameOver) return;
    const entered = (pwEl.value || "").trim();
    if (!entered) return setBad("Entre une tentative üôÇ");

    if (entered === QUESTIONS[qIndex].answer) return winNow();

    setBad("‚ùå Pas encore. Essaie une autre combinaison !");
    pwEl.select();
  }

  btnEl.addEventListener("click", checkPassword);
  pwEl.addEventListener("keydown", (e)=>{ if(e.key==="Enter") checkPassword(); });
  skipBtnEl.addEventListener("click", nextQuestion);

  // Catch-up if user returns to tab
  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible" && !gameOver) {
      const elapsed = Date.now() - qStart;
      if (elapsed >= AUTO_SKIP_MS) nextQuestion();
      else if (elapsed >= HINT_AFTER_MS && !hintShown) showHintOnce();
    }
  });

  // Start game
  if (!gameOver) loadQuestion(0);
</script>
</body>
</html>

<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Guess The Password ‚Äì Score Mode</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#0b1220;color:#e8eefc}
  .wrap{max-width:920px;margin:auto;padding:18px}
  .card{background:#121c33;border:1px solid #223154;border-radius:16px;padding:16px;margin:12px 0}
  .h1{font-size:22px;font-weight:900}
  .h2{font-size:16px;font-weight:800}
  .muted{opacity:.8}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  input{flex:1;padding:12px;border-radius:12px;border:1px solid #2a3b66;background:#0b1220;color:#e8eefc;font-size:16px}
  button{padding:12px 14px;border-radius:12px;border:0;background:#2b6cff;color:white;font-weight:800;font-size:16px;cursor:pointer}
  button:disabled{opacity:.55;cursor:not-allowed}
  .badge{padding:6px 10px;border-radius:999px;border:1px solid #2a3b66;background:#0b1220;font-size:13px;display:inline-block}
  .bad{background:#2a1111;border-color:#b13a3a}
  .ok{background:#0c2a16;border-color:#1f7a43}
  .warn{background:#2a250f;border-color:#caa43a}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  .progress{height:10px;border-radius:999px;background:#0b1220;border:1px solid #2a3b66;overflow:hidden;margin-top:10px}
  .bar{height:100%;width:0%;background:#2b6cff}
  pre{white-space:pre-wrap;line-height:1.35;margin:0}
  .big{font-size:22px;font-weight:900}
</style>
</head>

<body>
<div class="wrap">

  <div class="card">
    <div class="h1">üîê Guess The Password ‚Äî Score Mode</div>
    <div class="muted">1 min / question ‚Ä¢ Indice √† 40s ‚Ä¢ +1 bonne r√©ponse + points (temps restant) ‚Ä¢ Validation au stand</div>
    <div class="row" style="margin-top:10px">
      <span class="badge" id="qBadge">Question 1/20</span>
      <span class="badge" id="timerBadge">‚è≥ 01:00</span>
      <span class="badge" id="scoreBadge">‚≠ê Score: 0</span>
      <span class="badge" id="correctBadge">‚úÖ Correct: 0</span>
      <span class="badge mono">FORMAT: mot_minuscule_nombre!</span>
    </div>
  </div>

  <div class="card" id="gameCard">
    <div class="h2">üìÑ Dossier / Devinette</div>
    <pre id="prompt"></pre>

    <div class="progress"><div class="bar" id="bar"></div></div>

    <div class="row" style="margin-top:10px">
      <input id="pw" placeholder="mot_minuscule_nombre!" autocomplete="off"/>
      <button id="btn">TESTER</button>
      <button id="skipBtn" style="background:#44506b">PASSER</button>
    </div>

    <div id="msg" class="badge muted" style="margin-top:10px">Essais illimit√©s.</div>
    <div id="hintBox" class="badge warn" style="display:none;margin-top:10px">
      üí° Indice : <span id="hintText"></span>
    </div>

    <div class="badge ok mono" id="lastCodeBox" style="display:none;margin-top:10px">
      CODE √Ä MONTRER AU STAND : <span id="lastCode"></span>
    </div>
  </div>

  <div class="card" id="endCard" style="display:none">
    <div class="big">üèÅ Fin du jeu</div>
    <div class="muted" style="margin-top:6px">Montre ton √©cran au stand pour enregistrer ton score.</div>
    <div class="row" style="margin-top:10px">
      <span class="badge ok">‚úÖ Correct: <span id="endCorrect">0</span>/20</span>
      <span class="badge ok">‚≠ê Score: <span id="endScore">0</span></span>
    </div>
  </div>

</div>

<script>
  // ========= Temps =========
  const HINT_AFTER_MS = 40_000;  // 40s
  const QUESTION_MS   = 60_000;  // 60s

  // ========= Questions fictives (bios + devinettes) =========
  // IMPORTANT: profils fictifs, pour le jeu uniquement.
  const QUESTIONS = [
  { prompt:`Q1 ‚Äî Lghz
Chnahya l fakiha li kan liha iktichaf l jadibiya?
Jawb b kalma wa7da (darija).`,
    hint:`machi tfa7`,
    answer:`karmouss` },

  { prompt:`Q2 ‚Äî Bio (Aya)
Aya kat7eb ttsswir.
Ma katgoulch "photo", katgoul ghir "lens".
Ra9m li kay3jebha: 20-4/2+5-10.
Chno password?`,
    hint:`lens + 13`,
    answer:`lens13` },

  { prompt:`Q3 ‚Äî Lghz
Ana dayman 9damk,
w 3omrek ma t9der tl79ni.
Kalma + 3dad dyal 7rouf li fiha.`,
    hint:`mertabt b lwa9t`,
    answer:`avenir4` },

  { prompt:`Q4 ‚Äî Bio (Youssef)
Youssef m9awd f l kora.
Kaygoul "goat" l rassou b7al nickname.
taymooooot 3la messi.
Chno password?`,
    hint:`goat + nmra d messi`,
    answer:`goat10` },

  { prompt:`Q5 ‚Äî Lghz
Ktr ma kanwli nashf,
ktr kanwli mbllel.
Kalma + 3dad dyal 7rouf li fiha.`,
    hint:`7aja f ddar`,
    answer:`serviette9` },

  { prompt:`Q6 ‚Äî Bio (Sara)
Sara ma kat3a9edch l password.
Katst3mel smy dl9et dyalha dyalha: 9et b anglais.
3omrha 22.
Chno password?`,
    hint:`22 + smiya dl9et`,
    answer:`22cat` },

  { prompt:`Q7 ‚Äî Bio (Hicham)
Hicham 3ando kelb smiyto Rocky.
3omro 2 snin.
Kaydir smiya + l3omr.
Chno password?`,
    hint:`rocky + 2`,
    answer:`rocky2` },

  { prompt:`Q8 ‚Äî Lghz
N9der n7mik w n9der n3ks 3lik.
Ana mtkawen mn 7rouf w a3dad.
Kalma + 3dad dyal 7rouf.`,
    hint:`hada howa mowdou3 l3ba`,
    answer:`password8` },

  { prompt:`Q9 ‚Äî Bio (Hamza)
Pseudo dyalo DarkWolf,
bssa7 kayfaddel yst3mel "shadow".
Ra9m li kay7ebbo: 4.
Chno password?`,
    hint:`shadow + 4`,
    answer:`shadow4` },

  { prompt:`Q10 ‚Äî Lghz
Katb9a 3andek
mlli ma kayb9a 7ta klam.
Kalma b frc + 3dad dyal 7rouf li fiha .`,
    hint:`bla sda3, bla ssout`,
    answer:`silence7` },

  { prompt:`Q11 ‚Äî Bio (Imane)
Imane kat7eb lzra9,
katkteb "ocean" f bzzaf d lplaces.
3dad dyal 7rouf: 4.
Chno password?`,
    hint:`ocean + 4`,
    answer:`ocean4` },

  { prompt:`Q12 ‚Äî Bio (Lina)
Lina 3andha 9ett smiyto Luna,
bssa7 kat3ayyto b "moon".
3omro 3 snin.
Chno password?`,
    hint:`moon + 3`,
    answer:`moon3` },

  { prompt:`Q13 ‚Äî Lghz
Ana kan kber
mlli kat9ssemni m3a nass.
Kalma + 3dad dyal 7rouf.`,
    hint:`7ssassa, mashi chi haja maddiya`,
    answer:`fr7a` },

  { prompt:`Q14 ‚Äî Bio (Salma)
Salma kat7lem tmchi l Tokyo,
ma katktebch Japan.
3dad dyal 7rouf: 5.
Chno password?`,
    hint:`tokyo + 5`,
    answer:`tokyo5` },

  { prompt:`Q15 ‚Äî Lghz
Ma kanbanch,
walakin kan tb3ek f internet.
Kalma b frc + 3dad dyal 7rouf li fiha.`,
    hint:`katkhalli athar`,
    answer:`trace5` },

  { prompt:`Q16 ‚Äî Bio (Omar)
Omar f tests dyalo
kaydir dayman root.
Kayzid ra9m 1.
Chno password?`,
    hint:`root + 1`,
    answer:`root1` },

  { prompt:`Q17 ‚Äî Lghz (tech)
Ana dyal 2 factors,
ghaliban 6 a3dad.
Kalma = ?, 3dad = 6.`,
    hint:`OTP`,
    answer:`otp6` },

  { prompt:`Q18 ‚Äî Bio (Nadia)
Nadia kat7eb tacos,
katkteb taco bla s.
Katakol 2.
Chno password?`,
    hint:`taco + 2`,
    answer:`taco_2!` },

  { prompt:`Q19 ‚Äî Lghz
Aktr haja kattsra3 f telephone.
Kalma + 3dad dyal 7rouf dyalha.`,
    hint:`kattsra3 w katbdel`,
    answer:`ecran` },

  { prompt:`Q20 ‚Äî Finale
Jomla: "Never give up"
Kalma = akher kalma,
3dad = dyal 7rouf.`,
    hint:`akher kalma howa up`,
    answer:`up2` },
];

  // ========= UI =========
  const qBadge = document.getElementById("qBadge");
  const timerBadge = document.getElementById("timerBadge");
  const scoreBadge = document.getElementById("scoreBadge");
  const correctBadge = document.getElementById("correctBadge");
  const promptEl = document.getElementById("prompt");
  const pwEl = document.getElementById("pw");
  const btnEl = document.getElementById("btn");
  const skipBtnEl = document.getElementById("skipBtn");
  const msgEl = document.getElementById("msg");
  const hintBox = document.getElementById("hintBox");
  const hintText = document.getElementById("hintText");
  const barEl = document.getElementById("bar");
  const lastCodeBox = document.getElementById("lastCodeBox");
  const lastCodeEl = document.getElementById("lastCode");
  const endCard = document.getElementById("endCard");
  const endCorrect = document.getElementById("endCorrect");
  const endScore = document.getElementById("endScore");

  const gameCard = document.getElementById("gameCard");

  function pad(n){ return String(n).padStart(2,"0"); }
  function formatMMSS(ms){
    const s = Math.max(0, Math.ceil(ms/1000));
    const mm = Math.floor(s/60);
    const ss = s%60;
    return `${pad(mm)}:${pad(ss)}`;
  }
  function setBad(t){ msgEl.className="badge bad"; msgEl.textContent=t; }
  function setOk(t){ msgEl.className="badge ok"; msgEl.textContent=t; }
  function setInfo(t){ msgEl.className="badge muted"; msgEl.textContent=t; }

  // ========= Score state =========
  let qIndex = 0;
  let qStart = 0;
  let hintShown = false;

  let score = 0;
  let correct = 0;

  // session id pour codes (anti ‚Äúinvent√©‚Äù trop facile)
  const SID_KEY = "GTP_SID";
  let sid = localStorage.getItem(SID_KEY);
  if (!sid) {
    sid = Math.random().toString(36).slice(2,10).toUpperCase();
    localStorage.setItem(SID_KEY, sid);
  }

  // timers robustes
  let hintTimeout = null;
  let nextTimeout = null;
  let uiInterval = null;

  function clearTimers(){
    if (hintTimeout) { clearTimeout(hintTimeout); hintTimeout = null; }
    if (nextTimeout) { clearTimeout(nextTimeout); nextTimeout = null; }
    if (uiInterval)  { clearInterval(uiInterval); uiInterval = null; }
  }

  function makeCode(qi, remainingSeconds){
    // code court: Q + (2 chars SID) + (remaining)
    const part = sid.slice(0,2);
    const rem = String(Math.max(0, remainingSeconds)).padStart(2,"0");
    return `Q${qi+1}-${part}${sid.slice(-2)}-${rem}`;
  }

  function updateBadges(){
    scoreBadge.textContent = `‚≠ê Score: ${score}`;
    correctBadge.textContent = `‚úÖ Correct: ${correct}`;
  }

  function showHintOnce(){
    if (hintShown) return;
    hintShown = true;
    hintText.textContent = QUESTIONS[qIndex].hint;
    hintBox.style.display = "inline-block";
  }

  function scheduleTimers(){
    clearTimers();

    hintTimeout = setTimeout(() => showHintOnce(), HINT_AFTER_MS);
    nextTimeout = setTimeout(() => nextQuestion("‚è≠Ô∏è Temps √©coul√©. Question suivante."), QUESTION_MS);

    uiInterval = setInterval(() => {
      const elapsed = Date.now() - qStart;
      const remaining = Math.max(0, QUESTION_MS - elapsed);
      timerBadge.textContent = `‚è≥ ${formatMMSS(remaining)}`;
      barEl.style.width = Math.min(100, (elapsed / QUESTION_MS) * 100) + "%";

      if (!hintShown && elapsed >= HINT_AFTER_MS) showHintOnce();
      if (elapsed >= QUESTION_MS) nextQuestion("‚è≠Ô∏è Temps √©coul√©. Question suivante."); // fallback
    }, 200);
  }

  function loadQuestion(i){
    qIndex = i;
    qStart = Date.now();
    hintShown = false;

    qBadge.textContent = `Question ${qIndex+1}/20`;
    promptEl.textContent = QUESTIONS[qIndex].prompt;

    hintBox.style.display = "none";
    lastCodeBox.style.display = "none";
    pwEl.value = "";
    pwEl.focus();

    setInfo("Essais illimit√©s. Indice √† 40s.");
    updateBadges();

    scheduleTimers();
  }

  function finishGame(){
    clearTimers();
    gameCard.style.display = "none";
    endCard.style.display = "block";
    endCorrect.textContent = String(correct);
    endScore.textContent = String(score);
  }

  function nextQuestion(message){
    clearTimers();
    if (message) setInfo(message);

    if (qIndex >= QUESTIONS.length - 1) return finishGame();
    loadQuestion(qIndex + 1);
  }

  function onCorrect(){
    const elapsed = Date.now() - qStart;
    const remainingSec = Math.max(0, Math.ceil((QUESTION_MS - elapsed) / 1000));

    correct += 1;
    score += remainingSec; // points = secondes restantes
    updateBadges();

    const code = makeCode(qIndex, remainingSec);
    lastCodeEl.textContent = code;
    lastCodeBox.style.display = "inline-block";
    setOk(`‚úÖ Correct ! +${remainingSec} points. Va vite montrer le code au stand.`);

    // passe √† la question suivante rapidement (2s)
    clearTimers();
    setTimeout(() => {
      if (qIndex >= QUESTIONS.length - 1) finishGame();
      else loadQuestion(qIndex + 1);
    }, 2000);
  }

  function checkPassword(){
    const entered = (pwEl.value || "").trim();
    if (!entered) return setBad("Entre une tentative üôÇ");

    if (entered === QUESTIONS[qIndex].answer) return onCorrect();

    setBad("‚ùå Faux. R√©essaie !");
    pwEl.select();
  }

  btnEl.addEventListener("click", checkPassword);
  pwEl.addEventListener("keydown", (e)=>{ if(e.key==="Enter") checkPassword(); });
  skipBtnEl.addEventListener("click", () => nextQuestion("‚è≠Ô∏è Pass√©."));

  // rattrapage si l‚Äôapp ‚Äúg√®le‚Äù
  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") {
      const elapsed = Date.now() - qStart;
      if (elapsed >= QUESTION_MS) nextQuestion("‚è≠Ô∏è Temps √©coul√©. Question suivante.");
      else if (elapsed >= HINT_AFTER_MS && !hintShown) showHintOnce();
    }
  });

  // start
  loadQuestion(0);
</script>
</body>
</html>


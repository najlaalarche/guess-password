<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Guess The Password ‚Äì Score Mode</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#0b1220;color:#e8eefc}
  .wrap{max-width:920px;margin:auto;padding:18px}
  .card{background:#121c33;border:1px solid #223154;border-radius:16px;padding:16px;margin:12px 0}
  .h1{font-size:22px;font-weight:900}
  .h2{font-size:16px;font-weight:800}
  .muted{opacity:.8}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  input{flex:1;padding:12px;border-radius:12px;border:1px solid #2a3b66;background:#0b1220;color:#e8eefc;font-size:16px}
  button{padding:12px 14px;border-radius:12px;border:0;background:#2b6cff;color:white;font-weight:800;font-size:16px;cursor:pointer}
  button:disabled{opacity:.55;cursor:not-allowed}
  .badge{padding:6px 10px;border-radius:999px;border:1px solid #2a3b66;background:#0b1220;font-size:13px;display:inline-block}
  .bad{background:#2a1111;border-color:#b13a3a}
  .ok{background:#0c2a16;border-color:#1f7a43}
  .warn{background:#2a250f;border-color:#caa43a}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  .progress{height:10px;border-radius:999px;background:#0b1220;border:1px solid #2a3b66;overflow:hidden;margin-top:10px}
  .bar{height:100%;width:0%;background:#2b6cff}
  pre{white-space:pre-wrap;line-height:1.35;margin:0}
  .big{font-size:22px;font-weight:900}
</style>
</head>

<body>
<div class="wrap">

  <div class="card">
    <div class="h1">üîê Guess The Password ‚Äî Score Mode</div>
    <div class="muted">1 min / question ‚Ä¢ Indice √† 40s ‚Ä¢ +1 bonne r√©ponse + points (temps restant) ‚Ä¢ Validation au stand</div>
    <div class="row" style="margin-top:10px">
      <span class="badge" id="qBadge">Question 1/20</span>
      <span class="badge" id="timerBadge">‚è≥ 01:00</span>
      <span class="badge" id="scoreBadge">‚≠ê Score: 0</span>
      <span class="badge" id="correctBadge">‚úÖ Correct: 0</span>
      <span class="badge mono">FORMAT: mot_minuscule_nombre!</span>
    </div>
  </div>

  <div class="card" id="gameCard">
    <div class="h2">üìÑ Dossier / Devinette</div>
    <pre id="prompt"></pre>

    <div class="progress"><div class="bar" id="bar"></div></div>

    <div class="row" style="margin-top:10px">
      <input id="pw" placeholder="mot_minuscule_nombre!" autocomplete="off"/>
      <button id="btn">TESTER</button>
      <button id="skipBtn" style="background:#44506b">PASSER</button>
    </div>

    <div id="msg" class="badge muted" style="margin-top:10px">Essais illimit√©s.</div>
    <div id="hintBox" class="badge warn" style="display:none;margin-top:10px">
      üí° Indice : <span id="hintText"></span>
    </div>

    <div class="badge ok mono" id="lastCodeBox" style="display:none;margin-top:10px">
      CODE √Ä MONTRER AU STAND : <span id="lastCode"></span>
    </div>
  </div>

  <div class="card" id="endCard" style="display:none">
    <div class="big">üèÅ Fin du jeu</div>
    <div class="muted" style="margin-top:6px">Montre ton √©cran au stand pour enregistrer ton score.</div>
    <div class="row" style="margin-top:10px">
      <span class="badge ok">‚úÖ Correct: <span id="endCorrect">0</span>/20</span>
      <span class="badge ok">‚≠ê Score: <span id="endScore">0</span></span>
    </div>
  </div>

</div>

<script>
  // ========= Temps =========
  const HINT_AFTER_MS = 40_000;  // 40s
  const QUESTION_MS   = 60_000;  // 60s

  // ========= Questions fictives (bios + devinettes) =========
  // IMPORTANT: profils fictifs, pour le jeu uniquement.
  const QUESTIONS = [
    { prompt:`Q1 ‚Äî Bio (Simo)
N√© en 2001. Il √©crit souvent ‚Äúfamily first‚Äù.
Il met un mot simple + son ann√©e.
Devine le plus probable.`, hint:`mot li√© √† family`, answer:`family_2001!` },

    { prompt:`Q2 ‚Äî Bio (Aya)
Photo: elle dit ‚Äúlens‚Äù, jamais ‚Äúphoto‚Äù.
Chiffre f√©tiche: 13.`, hint:`lens + 13`, answer:`lens_13!` },

    { prompt:`Q3 ‚Äî Devinette
Je suis devant toi, tu ne peux jamais me rattraper.
Mot + lettres.`, hint:`temps`, answer:`avenir_6!` },

    { prompt:`Q4 ‚Äî Bio (Youssef)
Fan de foot. Il √©crit ‚Äúgoat‚Äù + 10.`, hint:`goat + 10`, answer:`goat_10!` },

    { prompt:`Q5 ‚Äî Devinette
Plus je s√®che, plus je deviens mouill√©e.
Mot + lettres.`, hint:`objet maison`, answer:`serviette_9!` },

    { prompt:`Q6 ‚Äî Bio (Sara)
Elle met son ‚Äúmood‚Äù: calm.
Nombre = 22.`, hint:`calm + 22`, answer:`calm_22!` },

    { prompt:`Q7 ‚Äî Bio (Hicham)
Chien: Rocky (2 ans).
Il met le nom + √¢ge.`, hint:`rocky + 2`, answer:`rocky_2!` },

    { prompt:`Q8 ‚Äî Devinette
Je peux te sauver ou te trahir, je suis fait de lettres/chiffres.
Mot + lettres.`, hint:`th√®me du jeu`, answer:`password_8!` },

    { prompt:`Q9 ‚Äî Bio (Hamza)
Pseudo: DarkWolf mais il pr√©f√®re ‚Äúshadow‚Äù.
Nombre = 4.`, hint:`shadow + 4`, answer:`shadow_4!` },

    { prompt:`Q10 ‚Äî Devinette
Tu m‚Äôas quand tu n‚Äôas plus rien √† dire.
Mot + lettres.`, hint:`absence de bruit`, answer:`silence_7!` },

    { prompt:`Q11 ‚Äî Bio (Imane)
Couleur pr√©f√©r√©e: bleu, mais elle √©crit ‚Äúocean‚Äù.
Nombre = 4.`, hint:`ocean + 4`, answer:`ocean_4!` },

    { prompt:`Q12 ‚Äî Bio (Lina)
Chat ‚ÄúLuna‚Äù, surnom ‚Äúmoon‚Äù.
√Çge = 3.`, hint:`moon + 3`, answer:`moon_3!` },

    { prompt:`Q13 ‚Äî Devinette
Je grandis quand on me partage.
Mot + lettres.`, hint:`√©motion`, answer:`joie_4!` },

    { prompt:`Q14 ‚Äî Bio (Salma)
Destination: Tokyo (pas Japon).
Nombre = 5.`, hint:`tokyo + 5`, answer:`tokyo_5!` },

    { prompt:`Q15 ‚Äî Devinette
Invisible mais je peux te suivre partout (en ligne).
Mot + lettres.`, hint:`trace`, answer:`trace_5!` },

    { prompt:`Q16 ‚Äî Bio (Omar)
Il met souvent ‚Äúroot‚Äù.
Nombre = 1.`, hint:`root + 1`, answer:`root_1!` },

    { prompt:`Q17 ‚Äî Devinette
Je suis √† 2 facteurs, souvent 6 chiffres.
Mot = ?, Nombre = 6.`, hint:`OTP`, answer:`otp_6!` },

    { prompt:`Q18 ‚Äî Bio (Nadia)
Elle √©crit ‚Äútaco‚Äù (sans s).
Nombre = 2.`, hint:`taco + 2`, answer:`taco_2!` },

    { prompt:`Q19 ‚Äî Devinette
La chose la plus cass√©e sur un t√©l√©phone.
Mot + lettres.`, hint:`√©cran`, answer:`ecran_5!` },

    { prompt:`Q20 ‚Äî Finale
Phrase: ‚ÄúNever give up‚Äù
Mot = dernier mot, Nombre = lettres.`, hint:`up`, answer:`up_2!` },
  ];

  // ========= UI =========
  const qBadge = document.getElementById("qBadge");
  const timerBadge = document.getElementById("timerBadge");
  const scoreBadge = document.getElementById("scoreBadge");
  const correctBadge = document.getElementById("correctBadge");
  const promptEl = document.getElementById("prompt");
  const pwEl = document.getElementById("pw");
  const btnEl = document.getElementById("btn");
  const skipBtnEl = document.getElementById("skipBtn");
  const msgEl = document.getElementById("msg");
  const hintBox = document.getElementById("hintBox");
  const hintText = document.getElementById("hintText");
  const barEl = document.getElementById("bar");
  const lastCodeBox = document.getElementById("lastCodeBox");
  const lastCodeEl = document.getElementById("lastCode");
  const endCard = document.getElementById("endCard");
  const endCorrect = document.getElementById("endCorrect");
  const endScore = document.getElementById("endScore");

  const gameCard = document.getElementById("gameCard");

  function pad(n){ return String(n).padStart(2,"0"); }
  function formatMMSS(ms){
    const s = Math.max(0, Math.ceil(ms/1000));
    const mm = Math.floor(s/60);
    const ss = s%60;
    return `${pad(mm)}:${pad(ss)}`;
  }
  function setBad(t){ msgEl.className="badge bad"; msgEl.textContent=t; }
  function setOk(t){ msgEl.className="badge ok"; msgEl.textContent=t; }
  function setInfo(t){ msgEl.className="badge muted"; msgEl.textContent=t; }

  // ========= Score state =========
  let qIndex = 0;
  let qStart = 0;
  let hintShown = false;

  let score = 0;
  let correct = 0;

  // session id pour codes (anti ‚Äúinvent√©‚Äù trop facile)
  const SID_KEY = "GTP_SID";
  let sid = localStorage.getItem(SID_KEY);
  if (!sid) {
    sid = Math.random().toString(36).slice(2,10).toUpperCase();
    localStorage.setItem(SID_KEY, sid);
  }

  // timers robustes
  let hintTimeout = null;
  let nextTimeout = null;
  let uiInterval = null;

  function clearTimers(){
    if (hintTimeout) { clearTimeout(hintTimeout); hintTimeout = null; }
    if (nextTimeout) { clearTimeout(nextTimeout); nextTimeout = null; }
    if (uiInterval)  { clearInterval(uiInterval); uiInterval = null; }
  }

  function makeCode(qi, remainingSeconds){
    // code court: Q + (2 chars SID) + (remaining)
    const part = sid.slice(0,2);
    const rem = String(Math.max(0, remainingSeconds)).padStart(2,"0");
    return `Q${qi+1}-${part}${sid.slice(-2)}-${rem}`;
  }

  function updateBadges(){
    scoreBadge.textContent = `‚≠ê Score: ${score}`;
    correctBadge.textContent = `‚úÖ Correct: ${correct}`;
  }

  function showHintOnce(){
    if (hintShown) return;
    hintShown = true;
    hintText.textContent = QUESTIONS[qIndex].hint;
    hintBox.style.display = "inline-block";
  }

  function scheduleTimers(){
    clearTimers();

    hintTimeout = setTimeout(() => showHintOnce(), HINT_AFTER_MS);
    nextTimeout = setTimeout(() => nextQuestion("‚è≠Ô∏è Temps √©coul√©. Question suivante."), QUESTION_MS);

    uiInterval = setInterval(() => {
      const elapsed = Date.now() - qStart;
      const remaining = Math.max(0, QUESTION_MS - elapsed);
      timerBadge.textContent = `‚è≥ ${formatMMSS(remaining)}`;
      barEl.style.width = Math.min(100, (elapsed / QUESTION_MS) * 100) + "%";

      if (!hintShown && elapsed >= HINT_AFTER_MS) showHintOnce();
      if (elapsed >= QUESTION_MS) nextQuestion("‚è≠Ô∏è Temps √©coul√©. Question suivante."); // fallback
    }, 200);
  }

  function loadQuestion(i){
    qIndex = i;
    qStart = Date.now();
    hintShown = false;

    qBadge.textContent = `Question ${qIndex+1}/20`;
    promptEl.textContent = QUESTIONS[qIndex].prompt;

    hintBox.style.display = "none";
    lastCodeBox.style.display = "none";
    pwEl.value = "";
    pwEl.focus();

    setInfo("Essais illimit√©s. Indice √† 40s.");
    updateBadges();

    scheduleTimers();
  }

  function finishGame(){
    clearTimers();
    gameCard.style.display = "none";
    endCard.style.display = "block";
    endCorrect.textContent = String(correct);
    endScore.textContent = String(score);
  }

  function nextQuestion(message){
    clearTimers();
    if (message) setInfo(message);

    if (qIndex >= QUESTIONS.length - 1) return finishGame();
    loadQuestion(qIndex + 1);
  }

  function onCorrect(){
    const elapsed = Date.now() - qStart;
    const remainingSec = Math.max(0, Math.ceil((QUESTION_MS - elapsed) / 1000));

    correct += 1;
    score += remainingSec; // points = secondes restantes
    updateBadges();

    const code = makeCode(qIndex, remainingSec);
    lastCodeEl.textContent = code;
    lastCodeBox.style.display = "inline-block";
    setOk(`‚úÖ Correct ! +${remainingSec} points. Va vite montrer le code au stand.`);

    // passe √† la question suivante rapidement (2s)
    clearTimers();
    setTimeout(() => {
      if (qIndex >= QUESTIONS.length - 1) finishGame();
      else loadQuestion(qIndex + 1);
    }, 2000);
  }

  function checkPassword(){
    const entered = (pwEl.value || "").trim();
    if (!entered) return setBad("Entre une tentative üôÇ");

    if (entered === QUESTIONS[qIndex].answer) return onCorrect();

    setBad("‚ùå Faux. R√©essaie !");
    pwEl.select();
  }

  btnEl.addEventListener("click", checkPassword);
  pwEl.addEventListener("keydown", (e)=>{ if(e.key==="Enter") checkPassword(); });
  skipBtnEl.addEventListener("click", () => nextQuestion("‚è≠Ô∏è Pass√©."));

  // rattrapage si l‚Äôapp ‚Äúg√®le‚Äù
  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") {
      const elapsed = Date.now() - qStart;
      if (elapsed >= QUESTION_MS) nextQuestion("‚è≠Ô∏è Temps √©coul√©. Question suivante.");
      else if (elapsed >= HINT_AFTER_MS && !hintShown) showHintOnce();
    }
  });

  // start
  loadQuestion(0);
</script>
</body>
</html>
